!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("infestines"),require("kefir"),require("kefir.partial.lenses"),require("karet.util")):"function"==typeof define&&define.amd?define(["exports","infestines","kefir","kefir.partial.lenses","karet.util"],t):t((e.karet=e.karet||{},e.karet.xhr={}),e.I,e.Kefir,e.kefir.partial.lenses,e.karet.util)}(this,function(e,t,r,n,s){"use strict";var o={type:"initial"},u=["loadstart","progress","timeout","load","error"],a="xhr",i="up",d="down",p=s.through(s.template,s.flatMapLatest(function(e){var s=e.url,a=e.method,p=void 0===a?"GET":a,l=e.user,c=void 0===l?null:l,f=e.password,g=void 0===f?null:f,y=e.headers,h=void 0===y?t.array0:y,m=e.overrideMimeType,v=e.body,w=void 0===v?null:v,H=e.responseType,T=e.timeout,k=e.withCredentials;return r.stream(function(e){var t=e.emit,r=e.end,a=new XMLHttpRequest,l={xhr:a,up:o,down:o},f=function(e,r){return function(s){t(l=n.set(e,{type:r,event:s},l))}};return u.forEach(function(e){a.addEventListener(e,f(d,e)),a.upload.addEventListener(e,f(i,e))}),a.addEventListener("readystatechange",function(e){t(l=n.set("event",e,l))}),a.addEventListener("loadend",function(e){r(t(l=n.set("event",e,l)))}),a.open(p,s,!0,c,g),H&&(a.responseType=H),T&&(a.timeout=T),k&&(a.withCredentials=k),h.forEach(function(e){a.setRequestHeader(e[0],e[1])}),m&&a.overrideMimeType(m),a.send(w),function(){a.status||a.abort()}})}),s.toProperty),l=t.curry(function(e,t){return e.includes(t)}),c=t.curry(function(e,t){return n.get([t,"type",l(e)])}),f=c(u),g=c(["progress","loadstart"]),y=c(["load"]),h=c(["error"]),m=c(["timeout"]),v=c(["load","error","timeout"]),w=t.curry(function(e,t){return n.get([t,"event",e])}),H=w("loaded"),T=w("total"),k=w("error"),E=function(e){return 200<=e&&e<300},L=f(i),x=g(i),S=y(i),q=h(i),M=m(i),R=v(i),b=H(i),C=T(i),I=k(i),P=f(d),U=g(d),F=y(d),O=h(d),X=m(d),j=v(d),_=H(d),A=T(d),D=k(d),G=n.get([a,"readyState"]),K=s.through(n.get([a,"response"]),s.skipDuplicates(t.acyclicEqualsU)),z=s.through(s.skipUnless(function(e){return 4===G(e)}),K),B=n.get([a,"responseType"]),J=n.get([a,"responseURL"]),N=n.get([a,n.when(n.get(["responseType",l(["","text"])])),"responseText"]),Q=n.get([a,n.when(n.get(["responseType",l(["","document"])])),"responseXML"]),V=n.get([a,"status"]),W=n.get([a,"status",E]),Y=n.get([a,"statusText"]),Z=t.curry(function(e,t){return n.get([a,n.reread(function(t){return t.getResponseHeader(e)})],t)}),$=n.get([a,n.reread(function(e){return e.getAllResponseHeaders()})]),ee=n.get([a,"timeout"]),te=n.get([a,"withCredentials"]),re=s.lift(E);e.perform=p,e.upHasStarted=L,e.upIsProgressing=x,e.upHasSucceeded=S,e.upHasFailed=q,e.upHasTimedOut=M,e.upHasEnded=R,e.upLoaded=b,e.upTotal=C,e.upError=I,e.downHasStarted=P,e.downIsProgressing=U,e.downHasSucceeded=F,e.downHasFailed=O,e.downHasTimedOut=X,e.downHasEnded=j,e.downLoaded=_,e.downTotal=A,e.downError=D,e.readyState=G,e.response=K,e.responseFull=z,e.responseType=B,e.responseURL=J,e.responseText=N,e.responseXML=Q,e.status=V,e.statusIsHttpSuccess=W,e.statusText=Y,e.responseHeader=Z,e.allResponseHeaders=$,e.timeout=ee,e.withCredentials=te,e.isHttpSuccess=re,Object.defineProperty(e,"__esModule",{value:!0})});
