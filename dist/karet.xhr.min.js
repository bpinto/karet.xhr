!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("infestines"),require("kefir"),require("kefir.partial.lenses"),require("karet.util")):"function"==typeof define&&define.amd?define(["exports","infestines","kefir","kefir.partial.lenses","karet.util"],t):t((e.karet=e.karet||{},e.karet.xhr={}),e.I,e.Kefir,e.kefir.partial.lenses,e.karet.util)}(this,function(e,t,r,n,o){"use strict";var s={type:"initial"},i="up",a="down",d=["loadstart","progress","timeout","load","error"],u=o.through(o.template,o.flatMapLatest(function(e){var o=e.url,u=e.method,p=void 0===u?"GET":u,f=e.headers,l=void 0===f?t.array0:f,c=e.body,h=void 0===c?null:c,v=e.responseType,y=void 0===v?"":v,g=e.timeout,m=void 0===g?0:g,w=e.withCredentials,H=void 0!==w&&w;return r.stream(function(e){var t=e.emit,r=e.end,u=new XMLHttpRequest,f={xhr:u,up:s,down:s},c=function(e,r){return function(o){t(f=n.set(e,{type:r,event:o},f))}};return d.forEach(function(e){u.addEventListener(e,c(a,e)),u.upload.addEventListener(e,c(i,e))}),u.addEventListener("readystatechange",function(e){t(n.set("event",e,f))}),u.addEventListener("loadend",function(e){r(t(n.set("event",e,f)))}),u.open(p,o),u.responseType=y,u.timeout=m,u.withCredentials=H,l.forEach(function(e){u.setRequestHeader(e[0],e[1])}),u.send(h),function(){u.abort()}})}),o.toProperty),p=function(e){return function(t){return n.get([t,"type",function(t){return e.includes(t)}])}},f=p(d),l=p(["progress","loadstart"]),c=p(["load"]),h=p(["error"]),v=p(["timeout"]),y=p(["load","error","timeout"]),g=function(e){return n.get([e,"event","loaded"])},m=function(e){return n.get([e,"event","total"])},w=f(i),H=l(i),k=c(i),x=h(i),T=v(i),E=y(i),L=g(i),q=m(i),S=f(a),b=l(a),P=c(a),I=h(a),M=v(a),O=y(a),j=g(a),C=m(a),F=n.get(["xhr","readyState"]),R=o.through(n.get(["xhr","response"]),o.skipDuplicates(t.acyclicEqualsU)),_=n.get(["xhr","responseType"]),D=n.get(["xhr","status"]),G=n.get(["xhr","statusText"]),K=o.lift(function(e){return 200<=e&&e<300});e.perform=u,e.upHasStarted=w,e.upIsProgressing=H,e.upHasSucceeded=k,e.upHasFailed=x,e.upHasTimedOut=T,e.upHasEnded=E,e.upLoaded=L,e.upTotal=q,e.downHasStarted=S,e.downIsProgressing=b,e.downHasSucceeded=P,e.downHasFailed=I,e.downHasTimedOut=M,e.downHasEnded=O,e.downLoaded=j,e.downTotal=C,e.readyState=F,e.response=R,e.responseType=_,e.status=D,e.statusText=G,e.isHttpSuccess=K,Object.defineProperty(e,"__esModule",{value:!0})});
