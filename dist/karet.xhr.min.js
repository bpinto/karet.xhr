!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("karet.lift"),require("infestines"),require("kefir"),require("kefir.partial.lenses")):"function"==typeof define&&define.amd?define(["exports","karet.lift","infestines","kefir","kefir.partial.lenses","partial.lenses.validation"],t):t((e.karet=e.karet||{},e.karet.xhr={}),e.karet.lift,e.I,e.Kefir,e.kefir.partial.lenses)}(this,function(e,r,v,o,w,t){"use strict";var n=function(e){return e instanceof o.Observable},s=v.curry(function(e,t){return n(t)?t.skipDuplicates(e):t}),i=v.curry(function(e,t){if(n(t))return t.filter(e);if(e(t))return t;throw Error(e.name)}),a=function(e){return e},H={type:"initial"},T=["loadstart","progress","timeout","load","error"],u="xhr",h="up",k="down",E="event",d=(0,v.id)(function(e){var a=e.url,t=e.method,u=void 0===t?"GET":t,r=e.user,d=void 0===r?null:r,n=e.password,p=void 0===n?null:n,l=e.headers,f=e.overrideMimeType,s=e.body,c=void 0===s?null:s,y=e.responseType,g=e.timeout,m=e.withCredentials;return o.stream(function(e){var n=e.emit,t=e.end,r=new XMLHttpRequest,s={xhr:r,up:H,down:H},o=function(t,r){return function(e){n(s=w.set(t,{type:r,event:e},s))}};if(T.forEach(function(e){r.addEventListener(e,o(k,e)),r.upload.addEventListener(e,o(h,e))}),r.addEventListener("readystatechange",function(e){n(s=w.set(E,e,s))}),r.addEventListener("loadend",function(e){t(n(s=w.set(E,e,s)))}),r.open(u,a,!0,d,p),y&&(r.responseType=y),g&&(r.timeout=g),m&&(r.withCredentials=m),null!=l)if(v.isFunction(l.keys)&&(l=Array.from(l)),v.isArray(l))l.forEach(function(e){r.setRequestHeader(e[0],e[1])});else for(var i in l)r.setRequestHeader(i,l[i]);return f&&r.overrideMimeType(f),r.send(c),function(){r.status||r.abort()}})}),p=v.curry(function(e,t){return e.includes(t)}),l=v.curry(function(e,t){return w.get([t,"type",p(e)])}),f=l(T),c=l(["progress","loadstart"]),y=l(["load"]),g=l(["error"]),m=l(["timeout"]),L=l(["load","error","timeout"]),x=v.curry(function(e,t){return w.get([t,E,e])}),q=x("loaded"),R=x("total"),S=x("error"),b=function(e){return 200<=e&&e<300},M=a(f(h)),U=a(c(h)),C=a(y(h)),F=a(g(h)),I=a(m(h)),O=a(L(h)),P=a(q(h)),A=a(R(h)),D=a(S(h)),X=a(f(k)),j=a(c(k)),N=a(y(k)),_=a(g(k)),G=a(m(k)),K=a(L(k)),z=a(q(k)),B=a(R(k)),J=a(S(k)),Q=a(w.get([u,"readyState"])),V=v.defineNameU(w.get([E,"type",w.is("loadend")]),"isDone"),W=a(v.pipe2U(w.get([u,"response"]),s(v.acyclicEqualsU))),Y=a(v.pipe2U(i(V),W)),Z=a(w.get([u,"responseType"])),$=a(w.get([u,"responseURL"])),ee=a(w.get([u,w.when(w.get(["responseType",p(["","text"])])),"responseText"])),te=a(w.get([u,w.when(w.get(["responseType",p(["","document"])])),"responseXML"])),re=a(w.get([u,"status"])),ne=a(w.get([u,"status",b])),se=a(w.get([u,"statusText"])),oe=v.curryN(2,function(t){return w.get([u,w.reread(function(e){return e.getResponseHeader(t)})])}),ie=a(w.get([u,w.reread(function(e){return e.getAllResponseHeaders()})])),ae=a(w.get([u,"timeout"])),ue=a(w.get([u,"withCredentials"])),de=r.lift(b);e.perform=function(e){var t=r.combine([e],v.id);return(t!==e?t.flatMapLatest(d):d(t)).toProperty()},e.upHasStarted=M,e.upIsProgressing=U,e.upHasSucceeded=C,e.upHasFailed=F,e.upHasTimedOut=I,e.upHasEnded=O,e.upLoaded=P,e.upTotal=A,e.upError=D,e.downHasStarted=X,e.downIsProgressing=j,e.downHasSucceeded=N,e.downHasFailed=_,e.downHasTimedOut=G,e.downHasEnded=K,e.downLoaded=z,e.downTotal=B,e.downError=J,e.readyState=Q,e.isDone=V,e.response=W,e.responseFull=Y,e.responseType=Z,e.responseURL=$,e.responseText=ee,e.responseXML=te,e.status=re,e.statusIsHttpSuccess=ne,e.statusText=se,e.responseHeader=oe,e.allResponseHeaders=ie,e.timeout=ae,e.withCredentials=ue,e.isHttpSuccess=de,Object.defineProperty(e,"__esModule",{value:!0})});
