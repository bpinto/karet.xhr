!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("infestines"),require("kefir"),require("kefir.partial.lenses"),require("karet.lift")):"function"==typeof define&&define.amd?define(["exports","infestines","kefir","kefir.partial.lenses","karet.lift"],t):t((e.karet=e.karet||{},e.karet.xhr={}),e.I,e.Kefir,e.kefir.partial.lenses,e.karet.lift)}(this,function(e,v,m,w,r){"use strict";var t=function(e){return e},H={type:"initial"},T=["loadstart","progress","timeout","load","error"],n="xhr",h="up",k="down",s=function(e){var i=e.url,t=e.method,u=void 0===t?"GET":t,r=e.user,a=void 0===r?null:r,n=e.password,d=void 0===n?null:n,s=e.headers,p=void 0===s?v.array0:s,l=e.overrideMimeType,o=e.body,c=void 0===o?null:o,f=e.responseType,g=e.timeout,y=e.withCredentials;return m.stream(function(e){var n=e.emit,t=e.end,r=new XMLHttpRequest,s={xhr:r,up:H,down:H},o=function(t,r){return function(e){n(s=w.set(t,{type:r,event:e},s))}};return T.forEach(function(e){r.addEventListener(e,o(k,e)),r.upload.addEventListener(e,o(h,e))}),r.addEventListener("readystatechange",function(e){n(s=w.set("event",e,s))}),r.addEventListener("loadend",function(e){t(n(s=w.set("event",e,s)))}),r.open(u,i,!0,a,d),f&&(r.responseType=f),g&&(r.timeout=g),y&&(r.withCredentials=y),p.forEach(function(e){r.setRequestHeader(e[0],e[1])}),l&&r.overrideMimeType(l),r.send(c),function(){r.status||r.abort()}})},o=v.curry(function(e,t){return e.includes(t)}),i=v.curry(function(e,t){return w.get([t,"type",o(e)])}),u=i(T),a=i(["progress","loadstart"]),d=i(["load"]),p=i(["error"]),l=i(["timeout"]),c=i(["load","error","timeout"]),f=v.curry(function(e,t){return w.get([t,"event",e])}),g=f("loaded"),y=f("total"),E=f("error"),L=function(e){return 200<=e&&e<300},x=t(u(h)),S=t(a(h)),q=t(d(h)),M=t(p(h)),R=t(l(h)),b=t(c(h)),U=t(g(h)),C=t(y(h)),I=t(E(h)),P=t(u(k)),F=t(a(k)),O=t(d(k)),X=t(p(k)),j=t(l(k)),_=t(c(k)),A=t(g(k)),D=t(y(k)),G=t(E(k)),K=t(w.get([n,"readyState"])),N=t(v.pipe2U(w.get([n,"response"]),function(e){return e.skipDuplicates(v.acyclicEqualsU)})),z=t(v.pipe2U(function(e){return e.filter(function(e){return 4===K(e)})},N)),B=t(w.get([n,"responseType"])),J=t(w.get([n,"responseURL"])),Q=t(w.get([n,w.when(w.get(["responseType",o(["","text"])])),"responseText"])),V=t(w.get([n,w.when(w.get(["responseType",o(["","document"])])),"responseXML"])),W=t(w.get([n,"status"])),Y=t(w.get([n,"status",L])),Z=t(w.get([n,"statusText"])),$=v.curryN(2,function(t){return w.get([n,w.reread(function(e){return e.getResponseHeader(t)})])}),ee=t(w.get([n,w.reread(function(e){return e.getAllResponseHeaders()})])),te=t(w.get([n,"timeout"])),re=t(w.get([n,"withCredentials"])),ne=r.lift(L);e.perform=function(e){var t=r.combine([e],v.id);return(t!==e?t.flatMapLatest(s):s(t)).toProperty()},e.upHasStarted=x,e.upIsProgressing=S,e.upHasSucceeded=q,e.upHasFailed=M,e.upHasTimedOut=R,e.upHasEnded=b,e.upLoaded=U,e.upTotal=C,e.upError=I,e.downHasStarted=P,e.downIsProgressing=F,e.downHasSucceeded=O,e.downHasFailed=X,e.downHasTimedOut=j,e.downHasEnded=_,e.downLoaded=A,e.downTotal=D,e.downError=G,e.readyState=K,e.response=N,e.responseFull=z,e.responseType=B,e.responseURL=J,e.responseText=Q,e.responseXML=V,e.status=W,e.statusIsHttpSuccess=Y,e.statusText=Z,e.responseHeader=$,e.allResponseHeaders=ee,e.timeout=te,e.withCredentials=re,e.isHttpSuccess=ne,Object.defineProperty(e,"__esModule",{value:!0})});
