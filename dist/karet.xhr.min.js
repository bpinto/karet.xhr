!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("infestines"),require("kefir"),require("kefir.partial.lenses"),require("karet.util")):"function"==typeof define&&define.amd?define(["exports","infestines","kefir","kefir.partial.lenses","karet.util"],t):t((e.karet=e.karet||{},e.karet.xhr={}),e.I,e.Kefir,e.kefir.partial.lenses,e.karet.util)}(this,function(e,h,m,v,t){"use strict";var r=function(e){return e},w={type:"initial"},H=["loadstart","progress","timeout","load","error"],n="xhr",T="up",k="down",s=r(t.through(t.template,t.flatMapLatest(function(e){var u=e.url,t=e.method,i=void 0===t?"GET":t,r=e.user,a=void 0===r?null:r,n=e.password,d=void 0===n?null:n,s=e.headers,p=void 0===s?h.array0:s,l=e.overrideMimeType,o=e.body,c=void 0===o?null:o,f=e.responseType,g=e.timeout,y=e.withCredentials;return m.stream(function(e){var n=e.emit,t=e.end,r=new XMLHttpRequest,s={xhr:r,up:w,down:w},o=function(t,r){return function(e){n(s=v.set(t,{type:r,event:e},s))}};return H.forEach(function(e){r.addEventListener(e,o(k,e)),r.upload.addEventListener(e,o(T,e))}),r.addEventListener("readystatechange",function(e){n(s=v.set("event",e,s))}),r.addEventListener("loadend",function(e){t(n(s=v.set("event",e,s)))}),r.open(i,u,!0,a,d),f&&(r.responseType=f),g&&(r.timeout=g),y&&(r.withCredentials=y),p.forEach(function(e){r.setRequestHeader(e[0],e[1])}),l&&r.overrideMimeType(l),r.send(c),function(){r.status||r.abort()}})}),t.toProperty)),o=h.curry(function(e,t){return e.includes(t)}),u=h.curry(function(e,t){return v.get([t,"type",o(e)])}),i=u(H),a=u(["progress","loadstart"]),d=u(["load"]),p=u(["error"]),l=u(["timeout"]),c=u(["load","error","timeout"]),f=h.curry(function(e,t){return v.get([t,"event",e])}),g=f("loaded"),y=f("total"),E=f("error"),L=function(e){return 200<=e&&e<300},x=r(i(T)),S=r(a(T)),q=r(d(T)),M=r(p(T)),R=r(l(T)),b=r(c(T)),C=r(g(T)),I=r(y(T)),P=r(E(T)),U=r(i(k)),F=r(a(k)),O=r(d(k)),X=r(p(k)),j=r(l(k)),_=r(c(k)),A=r(g(k)),D=r(y(k)),G=r(E(k)),K=r(v.get([n,"readyState"])),N=r(t.through(v.get([n,"response"]),t.skipDuplicates(h.acyclicEqualsU))),z=r(t.through(t.skipUnless(function(e){return 4===K(e)}),N)),B=r(v.get([n,"responseType"])),J=r(v.get([n,"responseURL"])),Q=r(v.get([n,v.when(v.get(["responseType",o(["","text"])])),"responseText"])),V=r(v.get([n,v.when(v.get(["responseType",o(["","document"])])),"responseXML"])),W=r(v.get([n,"status"])),Y=r(v.get([n,"status",L])),Z=r(v.get([n,"statusText"])),$=h.curryN(2,function(t){return v.get([n,v.reread(function(e){return e.getResponseHeader(t)})])}),ee=r(v.get([n,v.reread(function(e){return e.getAllResponseHeaders()})])),te=r(v.get([n,"timeout"])),re=r(v.get([n,"withCredentials"])),ne=t.lift(L);e.perform=s,e.upHasStarted=x,e.upIsProgressing=S,e.upHasSucceeded=q,e.upHasFailed=M,e.upHasTimedOut=R,e.upHasEnded=b,e.upLoaded=C,e.upTotal=I,e.upError=P,e.downHasStarted=U,e.downIsProgressing=F,e.downHasSucceeded=O,e.downHasFailed=X,e.downHasTimedOut=j,e.downHasEnded=_,e.downLoaded=A,e.downTotal=D,e.downError=G,e.readyState=K,e.response=N,e.responseFull=z,e.responseType=B,e.responseURL=J,e.responseText=Q,e.responseXML=V,e.status=W,e.statusIsHttpSuccess=Y,e.statusText=Z,e.responseHeader=$,e.allResponseHeaders=ee,e.timeout=te,e.withCredentials=re,e.isHttpSuccess=ne,Object.defineProperty(e,"__esModule",{value:!0})});
