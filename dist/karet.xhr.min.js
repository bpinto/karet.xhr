!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("infestines"),require("kefir"),require("kefir.partial.lenses"),require("karet.util")):"function"==typeof define&&define.amd?define(["exports","infestines","kefir","kefir.partial.lenses","karet.util"],t):t((e.karet=e.karet||{},e.karet.xhr={}),e.I,e.Kefir,e.kefir.partial.lenses,e.karet.util)}(this,function(e,t,r,n,o){"use strict";var s={type:"initial"},a=["loadstart","progress","timeout","load","error"],i="up",d="down",u=o.through(o.template,o.flatMapLatest(function(e){var o=e.url,u=e.method,p=void 0===u?"GET":u,l=e.user,f=void 0===l?null:l,c=e.password,y=void 0===c?null:c,h=e.headers,v=void 0===h?t.array0:h,g=e.overrideMimeType,H=e.body,m=void 0===H?null:H,w=e.responseType,x=void 0===w?"":w,T=e.timeout,k=void 0===T?0:T,E=e.withCredentials,L=void 0!==E&&E;return r.stream(function(e){var t=e.emit,r=e.end,u=new XMLHttpRequest,l={xhr:u,up:s,down:s},c=function(e,r){return function(o){t(l=n.set(e,{type:r,event:o},l))}};return a.forEach(function(e){u.addEventListener(e,c(d,e)),u.upload.addEventListener(e,c(i,e))}),u.addEventListener("readystatechange",function(e){t(l=n.set("event",e,l))}),u.addEventListener("loadend",function(e){r(t(l=n.set("event",e,l)))}),u.open(p,o,!0,f,y),u.responseType=x,u.timeout=k,u.withCredentials=L,v.forEach(function(e){u.setRequestHeader(e[0],e[1])}),g&&u.overrideMimeType(g),u.send(m),function(){u.abort()}})}),o.toProperty),p=t.curry(function(e,t){return n.get([t,"type",function(t){return e.includes(t)}])}),l=p(a),f=p(["progress","loadstart"]),c=p(["load"]),y=p(["error"]),h=p(["timeout"]),v=p(["load","error","timeout"]),g=t.curry(function(e,t){return n.get([t,"event",e])}),H=g("loaded"),m=g("total"),w=g("error"),x=l(i),T=f(i),k=c(i),E=y(i),L=h(i),q=v(i),R=H(i),S=m(i),M=w(i),b=l(d),P=f(d),I=c(d),O=y(d),U=h(d),j=v(d),C=H(d),F=m(d),_=w(d),A=n.get(["xhr","readyState"]),D=o.through(n.get(["xhr","response"]),o.skipDuplicates(t.acyclicEqualsU)),G=n.get(["xhr","responseType"]),K=n.get(["xhr","responseURL"]),X=n.get(["xhr","status"]),z=n.get(["xhr","statusText"]),B=t.curry(function(e,t){return n.get(["xhr",n.reread(function(t){return t.getResponseHeader(e)})],t)}),J=n.get(["xhr",n.reread(function(e){return e.getAllResponseHeaders()})]),N=o.lift(function(e){return 200<=e&&e<300});e.perform=u,e.upHasStarted=x,e.upIsProgressing=T,e.upHasSucceeded=k,e.upHasFailed=E,e.upHasTimedOut=L,e.upHasEnded=q,e.upLoaded=R,e.upTotal=S,e.upError=M,e.downHasStarted=b,e.downIsProgressing=P,e.downHasSucceeded=I,e.downHasFailed=O,e.downHasTimedOut=U,e.downHasEnded=j,e.downLoaded=C,e.downTotal=F,e.downError=_,e.readyState=A,e.response=D,e.responseType=G,e.responseURL=K,e.status=X,e.statusText=z,e.responseHeader=B,e.allResponseHeaders=J,e.isHttpSuccess=N,Object.defineProperty(e,"__esModule",{value:!0})});
