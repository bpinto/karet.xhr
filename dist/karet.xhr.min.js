!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("infestines"),require("kefir"),require("kefir.partial.lenses"),require("karet.util")):"function"==typeof define&&define.amd?define(["exports","infestines","kefir","kefir.partial.lenses","karet.util"],t):t((e.karet=e.karet||{},e.karet.xhr={}),e.I,e.Kefir,e.kefir.partial.lenses,e.karet.util)}(this,function(e,t,r,n,s){"use strict";var o={type:"initial"},i=["loadstart","progress","timeout","load","error"],a="xhr",u="up",d="down",p=s.through(s.template,s.flatMapLatest(function(e){var s=e.url,a=e.method,p=void 0===a?"GET":a,l=e.user,c=void 0===l?null:l,f=e.password,g=void 0===f?null:f,y=e.headers,h=void 0===y?t.array0:y,m=e.overrideMimeType,v=e.body,w=void 0===v?null:v,H=e.responseType,T=e.timeout,k=e.withCredentials;return r.stream(function(e){var t=e.emit,r=e.end,a=new XMLHttpRequest,l={xhr:a,up:o,down:o},f=function(e,r){return function(s){t(l=n.set(e,{type:r,event:s},l))}};return i.forEach(function(e){a.addEventListener(e,f(d,e)),a.upload.addEventListener(e,f(u,e))}),a.addEventListener("readystatechange",function(e){t(l=n.set("event",e,l))}),a.addEventListener("loadend",function(e){r(t(l=n.set("event",e,l)))}),a.open(p,s,!0,c,g),H&&(a.responseType=H),T&&(a.timeout=T),k&&(a.withCredentials=k),h.forEach(function(e){a.setRequestHeader(e[0],e[1])}),m&&a.overrideMimeType(m),a.send(w),function(){a.abort()}})}),s.toProperty),l=t.curry(function(e,t){return e.includes(t)}),c=t.curry(function(e,t){return n.get([t,"type",l(e)])}),f=c(i),g=c(["progress","loadstart"]),y=c(["load"]),h=c(["error"]),m=c(["timeout"]),v=c(["load","error","timeout"]),w=t.curry(function(e,t){return n.get([t,"event",e])}),H=w("loaded"),T=w("total"),k=w("error"),E=f(u),L=g(u),x=y(u),q=h(u),M=m(u),R=v(u),S=H(u),b=T(u),C=k(u),P=f(d),I=g(d),O=y(d),U=h(d),X=m(d),j=v(d),F=H(d),_=T(d),A=k(d),D=n.get([a,"readyState"]),G=s.through(n.get([a,"response"]),s.skipDuplicates(t.acyclicEqualsU)),K=n.get([a,"responseType"]),z=n.get([a,"responseURL"]),B=n.get([a,n.when(n.get(["responseType",l(["","text"])])),"responseText"]),J=n.get([a,n.when(n.get(["responseType",l(["","document"])])),"responseXML"]),N=n.get([a,"status"]),Q=n.get([a,"statusText"]),V=t.curry(function(e,t){return n.get([a,n.reread(function(t){return t.getResponseHeader(e)})],t)}),W=n.get([a,n.reread(function(e){return e.getAllResponseHeaders()})]),Y=n.get([a,"timeout"]),Z=n.get([a,"withCredentials"]),$=s.lift(function(e){return 200<=e&&e<300});e.perform=p,e.upHasStarted=E,e.upIsProgressing=L,e.upHasSucceeded=x,e.upHasFailed=q,e.upHasTimedOut=M,e.upHasEnded=R,e.upLoaded=S,e.upTotal=b,e.upError=C,e.downHasStarted=P,e.downIsProgressing=I,e.downHasSucceeded=O,e.downHasFailed=U,e.downHasTimedOut=X,e.downHasEnded=j,e.downLoaded=F,e.downTotal=_,e.downError=A,e.readyState=D,e.response=G,e.responseType=K,e.responseURL=z,e.responseText=B,e.responseXML=J,e.status=N,e.statusText=Q,e.responseHeader=V,e.allResponseHeaders=W,e.timeout=Y,e.withCredentials=Z,e.isHttpSuccess=$,Object.defineProperty(e,"__esModule",{value:!0})});
