!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("karet.lift"),require("infestines"),require("kefir"),require("kefir.partial.lenses")):"function"==typeof define&&define.amd?define(["exports","karet.lift","infestines","kefir","kefir.partial.lenses","partial.lenses.validation"],t):t((e.karet=e.karet||{},e.karet.xhr={}),e.karet.lift,e.I,e.Kefir,e.kefir.partial.lenses)}(this,function(e,r,v,o,w,t){"use strict";var n=v.isString,s=v.isNumber,i=function(e){return e},H={type:"initial"},T=["loadstart","progress","timeout","load","error"],u="xhr",h="up",k="down",a=(0,v.id)(function(e){var u=e.url,t=e.method,a=void 0===t?"GET":t,r=e.user,d=void 0===r?null:r,n=e.password,p=void 0===n?null:n,l=e.headers,f=e.overrideMimeType,s=e.body,c=void 0===s?null:s,y=e.responseType,g=e.timeout,m=e.withCredentials;return o.stream(function(e){var n=e.emit,t=e.end,r=new XMLHttpRequest,s={xhr:r,up:H,down:H},o=function(t,r){return function(e){n(s=w.set(t,{type:r,event:e},s))}};if(T.forEach(function(e){r.addEventListener(e,o(k,e)),r.upload.addEventListener(e,o(h,e))}),r.addEventListener("readystatechange",function(e){n(s=w.set("event",e,s))}),r.addEventListener("loadend",function(e){t(n(s=w.set("event",e,s)))}),r.open(a,u,!0,d,p),y&&(r.responseType=y),g&&(r.timeout=g),m&&(r.withCredentials=m),null!=l)if(v.isFunction(l.keys)&&(l=Array.from(l)),v.isArray(l))l.forEach(function(e){r.setRequestHeader(e[0],e[1])});else for(var i in l)r.setRequestHeader(i,l[i]);return f&&r.overrideMimeType(f),r.send(c),function(){r.status||r.abort()}})}),d=v.curry(function(e,t){return e.includes(t)}),p=v.curry(function(e,t){return w.get([t,"type",d(e)])}),l=p(T),f=p(["progress","loadstart"]),c=p(["load"]),y=p(["error"]),g=p(["timeout"]),m=p(["load","error","timeout"]),E=v.curry(function(e,t){return w.get([t,"event",e])}),L=E("loaded"),x=E("total"),b=E("error"),S=function(e){return 200<=e&&e<300},q=i(l(h)),R=i(f(h)),M=i(c(h)),U=i(y(h)),C=i(g(h)),F=i(m(h)),I=i(L(h)),P=i(x(h)),A=i(b(h)),O=i(l(k)),X=i(f(k)),j=i(c(k)),N=i(y(k)),_=i(g(k)),D=i(m(k)),G=i(L(k)),K=i(x(k)),z=i(b(k)),B=i(w.get([u,"readyState"])),J=i(v.pipe2U(w.get([u,"response"]),function(e){return e.skipDuplicates(v.acyclicEqualsU)})),Q=i(v.pipe2U(function(e){return e.filter(function(e){return 4===B(e)})},J)),V=i(w.get([u,"responseType"])),W=i(w.get([u,"responseURL"])),Y=i(w.get([u,w.when(w.get(["responseType",d(["","text"])])),"responseText"])),Z=i(w.get([u,w.when(w.get(["responseType",d(["","document"])])),"responseXML"])),$=i(w.get([u,"status"])),ee=i(w.get([u,"status",S])),te=i(w.get([u,"statusText"])),re=v.curryN(2,function(t){return w.get([u,w.reread(function(e){return e.getResponseHeader(t)})])}),ne=i(w.get([u,w.reread(function(e){return e.getAllResponseHeaders()})])),se=i(w.get([u,"timeout"])),oe=i(w.get([u,"withCredentials"])),ie=r.lift(S);e.string=n,e.boolean=function(e){return"boolean"==typeof e},e.number=s,e.perform=function(e){var t=r.combine([e],v.id);return(t!==e?t.flatMapLatest(a):a(t)).toProperty()},e.upHasStarted=q,e.upIsProgressing=R,e.upHasSucceeded=M,e.upHasFailed=U,e.upHasTimedOut=C,e.upHasEnded=F,e.upLoaded=I,e.upTotal=P,e.upError=A,e.downHasStarted=O,e.downIsProgressing=X,e.downHasSucceeded=j,e.downHasFailed=N,e.downHasTimedOut=_,e.downHasEnded=D,e.downLoaded=G,e.downTotal=K,e.downError=z,e.readyState=B,e.response=J,e.responseFull=Q,e.responseType=V,e.responseURL=W,e.responseText=Y,e.responseXML=Z,e.status=$,e.statusIsHttpSuccess=ee,e.statusText=te,e.responseHeader=re,e.allResponseHeaders=ne,e.timeout=se,e.withCredentials=oe,e.isHttpSuccess=ie,Object.defineProperty(e,"__esModule",{value:!0})});
