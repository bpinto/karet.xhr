!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("karet.lift"),require("infestines"),require("kefir"),require("kefir.partial.lenses")):"function"==typeof define&&define.amd?define(["exports","karet.lift","infestines","kefir","kefir.partial.lenses","partial.lenses.validation"],t):t((e.karet=e.karet||{},e.karet.xhr={}),e.karet.lift,e.I,e.Kefir,e.kefir.partial.lenses)}(this,function(e,r,m,o,w,t){"use strict";var n=function(e){return e},H={type:"initial"},T=["loadstart","progress","timeout","load","error"],s="xhr",h="up",k="down",i=(0,m.id)(function(e){var u=e.url,t=e.method,a=void 0===t?"GET":t,r=e.user,d=void 0===r?null:r,n=e.password,p=void 0===n?null:n,l=e.headers,f=e.overrideMimeType,s=e.body,c=void 0===s?null:s,y=e.responseType,g=e.timeout,v=e.withCredentials;return o.stream(function(e){var n=e.emit,t=e.end,r=new XMLHttpRequest,s={xhr:r,up:H,down:H},o=function(t,r){return function(e){n(s=w.set(t,{type:r,event:e},s))}};if(T.forEach(function(e){r.addEventListener(e,o(k,e)),r.upload.addEventListener(e,o(h,e))}),r.addEventListener("readystatechange",function(e){n(s=w.set("event",e,s))}),r.addEventListener("loadend",function(e){t(n(s=w.set("event",e,s)))}),r.open(a,u,!0,d,p),y&&(r.responseType=y),g&&(r.timeout=g),v&&(r.withCredentials=v),null!=l)if(m.isFunction(l.keys)&&(l=Array.from(l)),m.isArray(l))l.forEach(function(e){r.setRequestHeader(e[0],e[1])});else for(var i in l)r.setRequestHeader(i,l[i]);return f&&r.overrideMimeType(f),r.send(c),function(){r.status||r.abort()}})}),u=m.curry(function(e,t){return e.includes(t)}),a=m.curry(function(e,t){return w.get([t,"type",u(e)])}),d=a(T),p=a(["progress","loadstart"]),l=a(["load"]),f=a(["error"]),c=a(["timeout"]),y=a(["load","error","timeout"]),g=m.curry(function(e,t){return w.get([t,"event",e])}),v=g("loaded"),E=g("total"),L=g("error"),x=function(e){return 200<=e&&e<300},q=n(d(h)),R=n(p(h)),S=n(l(h)),M=n(f(h)),b=n(c(h)),U=n(y(h)),C=n(v(h)),F=n(E(h)),I=n(L(h)),P=n(d(k)),A=n(p(k)),O=n(l(k)),X=n(f(k)),j=n(c(k)),_=n(y(k)),D=n(v(k)),G=n(E(k)),K=n(L(k)),N=n(w.get([s,"readyState"])),z=n(m.pipe2U(w.get([s,"response"]),function(e){return e.skipDuplicates(m.acyclicEqualsU)})),B=n(m.pipe2U(function(e){return e.filter(function(e){return 4===N(e)})},z)),J=n(w.get([s,"responseType"])),Q=n(w.get([s,"responseURL"])),V=n(w.get([s,w.when(w.get(["responseType",u(["","text"])])),"responseText"])),W=n(w.get([s,w.when(w.get(["responseType",u(["","document"])])),"responseXML"])),Y=n(w.get([s,"status"])),Z=n(w.get([s,"status",x])),$=n(w.get([s,"statusText"])),ee=m.curryN(2,function(t){return w.get([s,w.reread(function(e){return e.getResponseHeader(t)})])}),te=n(w.get([s,w.reread(function(e){return e.getAllResponseHeaders()})])),re=n(w.get([s,"timeout"])),ne=n(w.get([s,"withCredentials"])),se=r.lift(x);e.perform=function(e){var t=r.combine([e],m.id);return(t!==e?t.flatMapLatest(i):i(t)).toProperty()},e.upHasStarted=q,e.upIsProgressing=R,e.upHasSucceeded=S,e.upHasFailed=M,e.upHasTimedOut=b,e.upHasEnded=U,e.upLoaded=C,e.upTotal=F,e.upError=I,e.downHasStarted=P,e.downIsProgressing=A,e.downHasSucceeded=O,e.downHasFailed=X,e.downHasTimedOut=j,e.downHasEnded=_,e.downLoaded=D,e.downTotal=G,e.downError=K,e.readyState=N,e.response=z,e.responseFull=B,e.responseType=J,e.responseURL=Q,e.responseText=V,e.responseXML=W,e.status=Y,e.statusIsHttpSuccess=Z,e.statusText=$,e.responseHeader=ee,e.allResponseHeaders=te,e.timeout=re,e.withCredentials=ne,e.isHttpSuccess=se,Object.defineProperty(e,"__esModule",{value:!0})});
